# 二层交换与三层交换
***
本文主要阐述二层交换机、三层交换机与路由器的基本工作原理和三者之间的主要区别。

## 传输协议
***

* 物理层：传输单位bit，硬件双绞线，中继器，集线器等
* 数据链路层：传输单位帧，硬件网桥，交换机
* 网络层：传输单位IP数据报，硬件路由器
* 传输层：传输单位报文段（TCP)，用户数据报(UDP)


## 二层交换（数据链路层）
***
二层交换机：属于数据链路层设备，可以识别数据帧中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。
具体如下：

* （1）当交换机从某个端口收到一个数据包，读取包头的源MAC地址
* （2）读取包头的目的MAC地址，并在地址表中查找相应的端口
* （3）如果表中能找到目的MAC地址相应的端口，把数据包直接复制到这端口

## 三层交换机
***
三层交换技术是将路由和交换技术合二为一。在对一个数据流进行路由后，它将会产生一个MAC地址与IP地址的映射表，当同样的数据流到达时，它将根据此表直接从二层通过而不是再次路由，从而消除了路由器进行路由选择而造成的网络的延迟，提高了数据包转发的效率。

## 路由器（IP层）
***
属于IP层，其主要任务是接收数据包之后，根据其中包含的目的地址，决定转发到下一个地址。因此，路由器首先得在转发路由表中查找它的目的地址，若找到了目的地址，就在数据包的帧前添加下一个MAC地址，同时IP数据包头的TTL减数。

## 相互的联系和区别
***
二层交换机工作在数据链路层，三层交换机工作在网络层，路由器工作在网络层。

### 二层交换机和三层交换机
***
三层交换机使用了三层交换技术

简单地说，三层交换技术就是：二层交换技术＋三层转发技术。它解决了局域网中网段划分之后，网段中子网必须依赖路由器进行管理的局面，解决了传统路由器低速、复杂所造成的网络瓶颈问题。

其原理是：假设两个使用IP协议的站点A、B通过第三层交换机进行通信，发送站点A在开始发送时，把自己的IP地址与B站的IP地址比较，判断B站是否与自己在同一子网内。

若目的站B与发送站A在同一子网内，则进行二层的转发；

若两个站点不在同一子网内，如发送站A要与目的站B通信，发送站A要向“缺省网关”发出ARP(地址转换协议，用于将IP地址转换为MAC地址)，而“缺省网关”的IP地址其实是三层交换机的三层交换模块。当发送站A对“缺省网关”的IP地址广播出一个ARP请求时，如果三层交换模块在以前的通信过程中已经知道B站的MAC地址，则向发送站A回复B的MAC地址。否则三层交换模块根据路由信息向B站广播一个ARP请求，B站得到此ARP请求后向三层交换模块回复其MAC地址，三层交换模块保存此地址并回复给发送站A,同时将B站的MAC地址发送到二层交换引擎的MAC地址表中。从这以后，当A向B发送的数据包便全部交给二层交换处理，信息得以高速交换。由于仅仅在路由过程中才需要三层处理，绝大部分数据都通过二层交换转发，因此三层交换机的速度很快，接近二层交换机的速度。

### 二层交换机和路由器
***
传统交换机从网桥发展而来，属于OSI第二层即数据链路层设备。它根据MAC地址寻址，通过站表选择路由，站表的建立和维护由交换机自动进行。路由器属于OSI第三层即网络层设备，它根据IP地址进行寻址，通过路由表路由协议产生。交换机最大的好处是快速，由于交换机只须识别帧中MAC地址，直接根据MAC地址产生选择转发端口算法简单，因此转发速度极高。

子网划分：交换机只能识别MAC地址。MAC地址是物理地址，而且采用平坦的地址结构，因此不能根据MAC地址来划分子网。而路由器识别IP地址，IP地址由网络管理员分配，是逻辑地址且IP地址具有层次结构，被划分成网络号和主机号，可以非常方便地用于划分子网，路由器的主要功能就是用于连接不同的网络。

划分子网可以缩小广播域，减少广播风暴对网络的影响。路由器每一接口连接一个子网，广播报文不能经过路由器广播出去，连接在路由器不同接口的子网属于不同子网，子网范围由路由器物理划分。对交换机而言，每一个端口对应一个网段，由于子网由若干网段构成，通过对交换机端口的组合，可以逻辑划分子网。广播报文只能在子网内广播，不能扩散到别的子网内，通过合理划分逻辑子网，达到控制广播的目的。由于逻辑子网由交换机端口任意组合，没有物理上的相关性，因此称为虚拟子网，或叫虚拟网。虚拟网技术不用路由器就解决了广播报文的隔离问题，且虚拟网内网段与其物理位置无关，即相邻网段可以属于不同虚拟网，而相隔甚远的两个网段可能属于不同虚拟网，而相隔甚远的两个网段可能属于同一个虚拟网。不同虚拟网内的终端之间不能相互通信，增强了对网络内数据的访问控制。